<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Backward Resource Compatibility #  Context #  As we close in on a beta release, we are considering modification of the version prefix used for code-generated resources.
Option 1: Do nothing #  Leave all generated resources using the alpha prefix that is currently in use.
Pros
 Easy to implement (nothing to do) and quick to deliver  Cons
  Introduces an inconsistency between the status of ASO (beta) and the labelling of the resources (alpha).">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="2022-02: Backward Resource Compatibility" />
<meta property="og:description" content="Backward Resource Compatibility #  Context #  As we close in on a beta release, we are considering modification of the version prefix used for code-generated resources.
Option 1: Do nothing #  Leave all generated resources using the alpha prefix that is currently in use.
Pros
 Easy to implement (nothing to do) and quick to deliver  Cons
  Introduces an inconsistency between the status of ASO (beta) and the labelling of the resources (alpha)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://azure.github.io/azure-service-operator/architecture-decision-records/adr-2022-02-backward-compatibility/" /><meta property="article:section" content="architecture-decision-records" />



<title>2022-02: Backward Resource Compatibility | Azure Service Operator</title>
<link rel="manifest" href="/azure-service-operator/manifest.json">
<link rel="icon" href="/azure-service-operator/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/azure-service-operator/book.min.46181bc93375ba932026e753b37c40e6ff8bb16a9ef770c78bcc663e4577b1ba.css" integrity="sha256-RhgbyTN1upMgJudTs3xA5v&#43;LsWqe93DHi8xmPkV3sbo=" crossorigin="anonymous">
  <script defer src="/azure-service-operator/flexsearch.min.js"></script>
  <script defer src="/azure-service-operator/en.search.min.6d0bb06df0225e46bfd7605a26a5518b75140215b9d87e5db1c8c863ced21e75.js" integrity="sha256-bQuwbfAiXka/12BaJqVRi3UUAhW52H5dscjIY87SHnU=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/azure-service-operator/"><span>Azure Service Operator</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  

  



  
  <ul>
    
      
        <li>
          
  
  

  
    <span>Userâ€™s Guide</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/metrics/" class="">Metrics</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/resources/" class="">Resources</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/annotations/" class="">Annotations understood by the operator</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/authentication/" class="">Authentication in Azure Service Operator v2</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/multitenant-deployment/" class="">Deploying Azure Service Operator v2 in multi-tenant mode</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/diagnosing-problems/" class="">Diagnosing problems</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/secrets/" class="">Handling secrets</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/installing-from-yaml/" class="">Installation: From YAML</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/tutorial-cosmosdb/" class="">Tutorial: CosmosDB to-do List</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/tutorial-postgresql/" class="">Tutorial: PostgreSQL Votes</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/conditions/" class="">Understanding Conditions</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>For Contributors</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/contributing/contributing/" class="">Contributing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/contributing/add-a-new-code-generated-resource/" class="">Adding a new code generated resource to ASO v2</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/contributing/generator-overview/" class="">Code Generator Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/contributing/create-a-new-release/" class="">Creating a new release of ASO v2</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Design &amp; Specifications</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/design/secrets/" class="">Azure Service Operator support for managing dataplane secrets</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/design/clarifying-object-structure/" class="">Clarifying object structure</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/design/defaulter-validator/" class="">Custom validation and defaulting for code generated resources</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/design/resource-states/" class="">Proposal for reporting resource Status</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/design/crossplane/" class="">Thoughts on performing provider-azure code generation for Crossplane</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/design/type-references-and-ownership/" class="">Type references and ownership</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/design/versioning/" class="">Versioning</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <span>Case Studies</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/design/versioning/case-studies/chained-storage-versions/" class="">Chained Storage Versions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/design/versioning/case-studies/fixed-storage-version/" class="">Fixed Storage Version</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/design/versioning/case-studies/rolling-storage-versions/" class="">Rolling Storage Versions</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/architecture-decision-records/" class="">Architecture Decision Records</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/architecture-decision-records/adr-2020-04-code-generation/" class="">2020-04: Why Code Generation?</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/architecture-decision-records/adr-2020-07-pipeline-architecture/" class="">2020-07: Pipeline Architecture</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/architecture-decision-records/adr-2020-11-abstract-syntax-trees/" class="">2020-11: AST Library Choice</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/architecture-decision-records/adr-2021-02-property-conversions/" class="">2021-02: Property Conversions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/architecture-decision-records/adr-2021-06-api-version-recovery/" class="">2021-06: API Version Recovery</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/architecture-decision-records/adr-2021-08-committing-generated-code/" class="">2021-08: Committing Generated Code</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/architecture-decision-records/adr-2022-01-reconciler-extensions/" class="">2022-01: Reconciler Extensions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/architecture-decision-records/adr-2022-02-backward-compatibility/" class=" active">2022-02: Backward Resource Compatibility</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>References</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/authorization.v1alpha1api20200801preview/" class="">authorization.azure.com/v1alpha1api20200801preview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/authorization.v1beta20200801preview/" class="">authorization.azure.com/v1beta20200801preview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/batch.v1alpha1api20210101/" class="">batch.azure.com/v1alpha1api20210101</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/batch.v1beta20210101/" class="">batch.azure.com/v1beta20210101</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/cache.v1alpha1api20201201/" class="">cache.azure.com/v1alpha1api20201201</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/cache.v1alpha1api20210301/" class="">cache.azure.com/v1alpha1api20210301</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/cache.v1beta20201201/" class="">cache.azure.com/v1beta20201201</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/cache.v1beta20210301/" class="">cache.azure.com/v1beta20210301</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/compute.v1alpha1api20200930/" class="">compute.azure.com/v1alpha1api20200930</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/compute.v1alpha1api20201201/" class="">compute.azure.com/v1alpha1api20201201</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/compute.v1alpha1api20210701/" class="">compute.azure.com/v1alpha1api20210701</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/compute.v1beta20200930/" class="">compute.azure.com/v1beta20200930</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/compute.v1beta20201201/" class="">compute.azure.com/v1beta20201201</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/compute.v1beta20210701/" class="">compute.azure.com/v1beta20210701</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/containerregistry.v1alpha1api20210901/" class="">containerregistry.azure.com/v1alpha1api20210901</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/containerregistry.v1beta20210901/" class="">containerregistry.azure.com/v1beta20210901</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/containerservice.v1alpha1api20210501/" class="">containerservice.azure.com/v1alpha1api20210501</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/containerservice.v1beta20210501/" class="">containerservice.azure.com/v1beta20210501</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/dbformysql.v1alpha1api20210501/" class="">dbformysql.azure.com/v1alpha1api20210501</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/dbformysql.v1beta20210501/" class="">dbformysql.azure.com/v1beta20210501</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/dbforpostgresql.v1alpha1api20210601/" class="">dbforpostgresql.azure.com/v1alpha1api20210601</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/dbforpostgresql.v1beta20210601/" class="">dbforpostgresql.azure.com/v1beta20210601</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/documentdb.v1alpha1api20210515/" class="">documentdb.azure.com/v1alpha1api20210515</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/documentdb.v1beta20210515/" class="">documentdb.azure.com/v1beta20210515</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/eventgrid.v1alpha1api20200601/" class="">eventgrid.azure.com/v1alpha1api20200601</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/eventgrid.v1beta20200601/" class="">eventgrid.azure.com/v1beta20200601</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/eventhub.v1alpha1api20211101/" class="">eventhub.azure.com/v1alpha1api20211101</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/eventhub.v1beta20211101/" class="">eventhub.azure.com/v1beta20211101</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/insights.v1alpha1api20180501preview/" class="">insights.azure.com/v1alpha1api20180501preview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/insights.v1alpha1api20200202/" class="">insights.azure.com/v1alpha1api20200202</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/insights.v1beta20180501preview/" class="">insights.azure.com/v1beta20180501preview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/insights.v1beta20200202/" class="">insights.azure.com/v1beta20200202</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/managedidentity.v1alpha1api20181130/" class="">managedidentity.azure.com/v1alpha1api20181130</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/managedidentity.v1beta20181130/" class="">managedidentity.azure.com/v1beta20181130</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/network.v1alpha1api20201101/" class="">network.azure.com/v1alpha1api20201101</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/network.v1beta20201101/" class="">network.azure.com/v1beta20201101</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/operationalinsights.v1alpha1api20210601/" class="">operationalinsights.azure.com/v1alpha1api20210601</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/operationalinsights.v1beta20210601/" class="">operationalinsights.azure.com/v1beta20210601</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/resources.v1alpha1api20200601/" class="">resources.azure.com/v1alpha1api20200601</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/resources.v1beta20200601/" class="">resources.azure.com/v1beta20200601</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/servicebus.v1alpha1api20210101preview/" class="">servicebus.azure.com/v1alpha1api20210101preview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/servicebus.v1beta20210101preview/" class="">servicebus.azure.com/v1beta20210101preview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/signalrservice.v1alpha1api20211001/" class="">signalrservice.azure.com/v1alpha1api20211001</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/signalrservice.v1beta20211001/" class="">signalrservice.azure.com/v1beta20211001</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/storage.v1alpha1api20210401/" class="">storage.azure.com/v1alpha1api20210401</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/storage.v1beta20210401/" class="">storage.azure.com/v1beta20210401</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/azure-service-operator/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>2022-02: Backward Resource Compatibility</strong>

  <label for="toc-control">
    
    <img src="/azure-service-operator/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#context">Context</a>
      <ul>
        <li><a href="#option-1-do-nothing">Option 1: Do nothing</a></li>
        <li><a href="#option-2-move-all-resources-to-beta">Option 2: Move all resources to beta</a></li>
        <li><a href="#option-3a-in-place-upgrade-for-existing-resources">Option 3a: In-place upgrade for existing resources</a></li>
        <li><a href="#option-3b-retain-the-alpha-version-for-existing-resources">Option 3b: Retain the alpha version for existing resources</a></li>
        <li><a href="#other-factors">Other factors</a></li>
      </ul>
    </li>
    <li><a href="#decision">Decision</a>
      <ul>
        <li><a href="#beta-0-release">Beta 0 Release</a></li>
        <li><a href="#beta-1-release">Beta 1 Release</a></li>
        <li><a href="#beta-n-release">Beta n Release</a></li>
      </ul>
    </li>
    <li><a href="#status">Status</a></li>
    <li><a href="#consequences">Consequences</a></li>
    <li><a href="#experience-report">Experience Report</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="backward-resource-compatibility">
  Backward Resource Compatibility
  <a class="anchor" href="#backward-resource-compatibility">#</a>
</h1>
<h2 id="context">
  Context
  <a class="anchor" href="#context">#</a>
</h2>
<p>As we close in on a beta release, we are considering modification of the version prefix used for code-generated resources.</p>
<h3 id="option-1-do-nothing">
  Option 1: Do nothing
  <a class="anchor" href="#option-1-do-nothing">#</a>
</h3>
<p>Leave all generated resources using the alpha prefix that is currently in use.</p>
<p>Pros</p>
<ul>
<li>Easy to implement (nothing to do) and quick to deliver</li>
</ul>
<p>Cons</p>
<ul>
<li>
<p>Introduces an inconsistency between the status of ASO (beta) and the labelling of the resources (alpha).</p>
</li>
<li>
<p>Might be perceived by some users as indicating these particular resources are still in alpha, and therefore pose significant a barrier to adoption of ASO.</p>
</li>
</ul>
<h3 id="option-2-move-all-resources-to-beta">
  Option 2: Move all resources to beta
  <a class="anchor" href="#option-2-move-all-resources-to-beta">#</a>
</h3>
<p>Change the generated prefix for all resources</p>
<p>Pros</p>
<ul>
<li>Easy to implement (change the prefix, update affected tests, and regenerate all files), and quick to deliver</li>
</ul>
<p>Cons</p>
<ul>
<li>
<p>Existing clusters with custom resources (CRs) reliant on ASO would break because ASO would no longer support the older alpha version.<br>
Mitigation: Users would need to manually delete the existing resource and creating a new CR with an updated version.</p>
</li>
<li>
<p>Any attempt to apply old alpha YAML will fail, as it no longer exists. This includes attempting to manually apply a YAML using <code>kubectl apply -f</code>, and through some other approaches where YAMLs are continuously applied, as in GitOps style workflows.<br>
Mitigation: For manual uses, modification of the YAML files being applied to change the version of the resources.<br>
Mitigation: For automated uses, modification of the deployment pipelines to change the version of the resources.</p>
</li>
</ul>
<h3 id="option-3a-in-place-upgrade-for-existing-resources">
  Option 3a: In-place upgrade for existing resources
  <a class="anchor" href="#option-3a-in-place-upgrade-for-existing-resources">#</a>
</h3>
<p>Change the generated prefix to <code>v1beta</code> for all resources, but retain the alpha storage variants of each existing resource. This would allow an upgraded ASO installation to promote any existing resources to the new storage version.</p>
<p>Pros</p>
<ul>
<li>
<p>Moderate effort to implement (requires a new pipeline stage to create the alpha storage variants for compatibility with older versions).</p>
</li>
<li>
<p>Existing clusters with custom resources reliant on ASO would continue to run because ASO would support conversion from the old hub version to the new.</p>
</li>
</ul>
<p>Cons</p>
<ul>
<li>
<p>Any attempt to apply old alpha YAML will fail, as it no longer exists. This includes attempting to manually apply a YAML using <code>kubectl apply -f</code>, and through some other approaches where YAMLs are continuously applied, as in GitOps style workflows.<br>
Mitigation: For manual uses, modification of the YAML files being applied to change the version of the resources.<br>
Mitigation: For automated uses, modification of the deployment pipelines to change the version of the resources.</p>
</li>
<li>
<p>CRDs will be 50% bigger than the alpha versions, due to the addition of another storage variant.<br>
Observation: We know there is an upper limit to the size of each CRD, though we&rsquo;re not very close to that yet.
Mitigation: Prune all documentation from the alpha variants to make them (much!) smaller</p>
</li>
</ul>
<h3 id="option-3b-retain-the-alpha-version-for-existing-resources">
  Option 3b: Retain the alpha version for existing resources
  <a class="anchor" href="#option-3b-retain-the-alpha-version-for-existing-resources">#</a>
</h3>
<p>Use a beta prefix for all resources. Also use our existing alpha prefix for all resources that were included in any alpha release of ASO, but not for new resources.</p>
<p>Pros</p>
<ul>
<li>
<p>Moderate effort to implement (requires pipeline and configuration changes to generate multiple versions of some resources).<br>
Observation: We could implement this in two parts, firstly generating all resources with both prefixes for <code>codegen-beta-0</code>, and then introducing configuration for newer resources in <code>codegen-beta-1</code>.</p>
</li>
<li>
<p>Existing clusters with custom resources reliant on ASO would continue to run because ASO would support conversion from the old hub version to the new.</p>
</li>
<li>
<p>Existing use of YAML containing alpha versions will continue to work, as they are still supported. This includes attempting to manually apply a YAML using <code>kubectl apply -f</code>, and through some other approaches where YAMLs are continuously applied, as in GitOps style workflows.</p>
</li>
</ul>
<p>Cons</p>
<ul>
<li>
<p>CRDs will be twice the size of the alpha versions, due to the addition of both API and storage variants.<br>
Observation: We know there is an upper limit to the size of each CRD, though we&rsquo;re not very close to that yet.<br>
Mitigation: Prune all documentation from the alpha resource versions</p>
</li>
<li>
<p>Possible user confusion from having multiple versions of each resource.<br>
Mitigation: Pruning documentation would push users towards the beta versions.</p>
</li>
</ul>
<h3 id="other-factors">
  Other factors
  <a class="anchor" href="#other-factors">#</a>
</h3>
<p>We don&rsquo;t want to maroon existing users of Azure Service Operator (ASO) by making this a breaking change. It&rsquo;s important to us to make upgrades of ASO as straightforward as possible.</p>
<p>Cross version compatibility between ARM versions of a resource (that is, for example, between <code>v1alpha1api20180101</code> and <code>v1alpha1api20200101</code>) is already implemented and well tested, so we should leverage that existing infrastructure.</p>
<p>Version skew policy in the Kubernetes ecosystem is to allow for one or two older minor versions of backward compatibility. This gives us the <em>option</em> of temporarily introducing backward compatibility with the <code>codegen-beta-0</code> release and then dropping it once we reach <code>codegen-beta-2</code> or greater.</p>
<h2 id="decision">
  Decision
  <a class="anchor" href="#decision">#</a>
</h2>
<p>We choose to prioritize a good upgrade experience for our users. We&rsquo;ll proceed with option 3b (Retain the alpha version for existing resources).</p>
<p>Change the prefix used for our resources from <code>v1alpha1api</code> to simply <code>v1beta</code>. (We don&rsquo;t need a minor number as part of the prefix. The original intention was to increment the minor version with each release of the operator, but the overhead of this is very high, so we&rsquo;ve instead used the prefix <code>v1alpha1api</code> for all our alpha releases.)</p>
<h3 id="beta-0-release">
  Beta 0 Release
  <a class="anchor" href="#beta-0-release">#</a>
</h3>
<p>All resources will be duplicated, published as both <code>v1beta</code> and as <code>v1alpha1api</code>. This includes new resources published for the first time in the beta.</p>
<p>Introduce a new pipeline stage to create additional versions for backward compatibility, each created by cloning an existing version but using a package name based on the old <code>v1alpha1api</code> prefix.</p>
<p>For example, the API resource <code>v1beta20201201storage/VirtualMachine</code> will be cloned as <code>v1alpha1api20201201/VirtualMachine</code>. Subsequent pipeline stages will create matching storage versions and the necessary conversions.</p>
<p><img src="images/adr-2022-02-backward-compatibility-single-version.png" alt="image" /></p>
<p>For the trivial case where we only support a single ARM version of a resource, this gives us full compatibility to upgrade an older (alpha) installation of ASO to a new beta release.</p>
<p>When we have multiple ARM versions in flight (as we do with <code>compute</code>), supporting all <em>potential</em> older resource versions gives us maximum compatibility without any need for configuration or to make any assumptions about which ARM versions were previously supported.</p>
<p><img src="images/adr-2022-02-backward-compatibility-multiple-version.png" alt="image" /></p>
<p>This approach also gives us backward compatibility when we have a mix of resources across multiple versions (as happens with both <code>compute</code> and <code>network</code>). We know from prior work (including introduction of the <code>PropertyBag</code> field) that conversions between storage versions are lossless.</p>
<h3 id="beta-1-release">
  Beta 1 Release
  <a class="anchor" href="#beta-1-release">#</a>
</h3>
<p>Additional configuration will ensure that resources introduced in that (or later) releases won&rsquo;t include alpha versions. This configuration will require opt-in for backward compatibility, so that the overhead for new resources is as low as possible. <a href="https://github.com/Azure/azure-service-operator/issues/2176">Issue #2176</a> has been logged to track this work.</p>
<h3 id="beta-n-release">
  Beta n Release
  <a class="anchor" href="#beta-n-release">#</a>
</h3>
<p>At some point, after giving users of ASO alpha releases a reasonable time frame, we will drop the alpha versions. We&rsquo;ll document this plan as a part of the <strong>Beta 0</strong> release.</p>
<h2 id="status">
  Status
  <a class="anchor" href="#status">#</a>
</h2>
<p>Proposed.</p>
<h2 id="consequences">
  Consequences
  <a class="anchor" href="#consequences">#</a>
</h2>
<p>With the supported format for old resources being derived from newer resources, we need to be careful about breaking changes (e.g. removing properties or changing property types) that might cause issues for users upgrading to the latest ASO.</p>
<p>Factors reducing the severity of this include:</p>
<ul>
<li>
<p>Our object shapes are defined by ARM resource versions, which have tight constraints on the types of permitted changes, so we&rsquo;re unlikely to have breaking changes from that source.</p>
</li>
<li>
<p>We have exactly the same compatibility issues between adjacent ASO releases, so our changes to the generator already have to consider this.</p>
</li>
<li>
<p>We only need to maintain backward compatibility across a small number of versions.</p>
</li>
</ul>
<h2 id="experience-report">
  Experience Report
  <a class="anchor" href="#experience-report">#</a>
</h2>
<p>TBC.</p>
<h2 id="references">
  References
  <a class="anchor" href="#references">#</a>
</h2>
<p>TBC.</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#context">Context</a>
      <ul>
        <li><a href="#option-1-do-nothing">Option 1: Do nothing</a></li>
        <li><a href="#option-2-move-all-resources-to-beta">Option 2: Move all resources to beta</a></li>
        <li><a href="#option-3a-in-place-upgrade-for-existing-resources">Option 3a: In-place upgrade for existing resources</a></li>
        <li><a href="#option-3b-retain-the-alpha-version-for-existing-resources">Option 3b: Retain the alpha version for existing resources</a></li>
        <li><a href="#other-factors">Other factors</a></li>
      </ul>
    </li>
    <li><a href="#decision">Decision</a>
      <ul>
        <li><a href="#beta-0-release">Beta 0 Release</a></li>
        <li><a href="#beta-1-release">Beta 1 Release</a></li>
        <li><a href="#beta-n-release">Beta n Release</a></li>
      </ul>
    </li>
    <li><a href="#status">Status</a></li>
    <li><a href="#consequences">Consequences</a></li>
    <li><a href="#experience-report">Experience Report</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












