<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Adding a new code generated resource to ASO v2 #  This document discusses how to add a new resource to the ASO v2 code generation configuration. Check out this PR if you&rsquo;d like to see what the end product looks like.
What resources can be code generated? #  Any ARM resource can be generated. There are a few ways to determine if a resource is an ARM resource:">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="" />
<meta property="og:description" content="Adding a new code generated resource to ASO v2 #  This document discusses how to add a new resource to the ASO v2 code generation configuration. Check out this PR if you&rsquo;d like to see what the end product looks like.
What resources can be code generated? #  Any ARM resource can be generated. There are a few ways to determine if a resource is an ARM resource:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://azure.github.io/azure-service-operator/contributing/add-a-new-code-generated-resource/" /><meta property="article:section" content="contributing" />



<title>Add a New Code Generated Resource | Azure Service Operator</title>
<link rel="manifest" href="/azure-service-operator/manifest.json">
<link rel="icon" href="/azure-service-operator/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/azure-service-operator/book.min.46181bc93375ba932026e753b37c40e6ff8bb16a9ef770c78bcc663e4577b1ba.css" integrity="sha256-RhgbyTN1upMgJudTs3xA5v&#43;LsWqe93DHi8xmPkV3sbo=" crossorigin="anonymous">
  <script defer src="/azure-service-operator/flexsearch.min.js"></script>
  <script defer src="/azure-service-operator/en.search.min.476d03ec7000998b14a12984129a30c5203c95fdc811490b47286ccaacddb6c2.js" integrity="sha256-R20D7HAAmYsUoSmEEpowxSA8lf3IEUkLRyhsyqzdtsI=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/azure-service-operator/"><span>Azure Service Operator</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  

  



  
  <ul>
    
      
        <li>
          
  
  

  
    <span>Userâ€™s Guide</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/annotations/" class="">Annotations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/authentication/" class="">Authentication</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/conditions/" class="">Conditions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/diagnosing-problems/" class="">Diagnosing Problems</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/multitenant-deployment/" class="">Multitenant Deployment</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/secrets/" class="">Secrets</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/resources/" class="">Resources</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/installing-from-yaml/" class="">Installation: From YAML</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/tutorial-cosmosdb/" class="">Tutorial: CosmosDB to-do List</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/introduction/tutorial-postgresql/" class="">Tutorial: PostgreSQL Votes</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>For Contributors</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/contributing/contributing/" class="">Contributing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/contributing/add-a-new-code-generated-resource/" class=" active">Add a New Code Generated Resource</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/contributing/create-a-new-release/" class="">Create a New Release</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/contributing/generator-overview/" class="">Generator Overview</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Design &amp; Specifications</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/design/clarifying-object-structure/" class="">Clarifying Object Structure</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/design/crossplane/" class="">Crossplane</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/design/defaulter-validator/" class="">Defaulter Validator</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/design/resource-states/" class="">Resource States</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/design/secrets/" class="">Secrets</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/design/type-references-and-ownership/" class="">Type References and Ownership</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/design/versioning/" class="">Versioning</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <span>Case Studies</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/design/versioning/case-studies/chained-storage-versions/" class="">Chained Storage Versions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/design/versioning/case-studies/fixed-storage-version/" class="">Fixed Storage Version</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/design/versioning/case-studies/rolling-storage-versions/" class="">Rolling Storage Versions</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/architecture-decision-records/" class="">Architecture Decision Records</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/architecture-decision-records/adr-2021-02-property-conversions/" class="">2021-02: Property Conversions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/architecture-decision-records/adr-2020-11-abstract-syntax-trees/" class="">2020-11: AST Library Choice</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/architecture-decision-records/adr-2020-07-pipeline-architecture/" class="">2020-07: Pipeline Architecture</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/architecture-decision-records/adr-2020-04-code-generation/" class="">2020-04: Why Code Generation?</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/architecture-decision-records/adr-2021-06-api-version-recovery/" class="">Adr 2021 06 API Version Recovery</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/architecture-decision-records/adr-2022-01-reconciler-extensions/" class="">Adr 2022 01 Reconciler Extensions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/architecture-decision-records/adr-2022-02-backward-compatibility/" class="">Adr 2022 02 Backward Compatibility</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>References</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/authorization.v1alpha1api20200801preview/" class="">Authorization.V1alpha1api20200801preview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/batch.v1alpha1api20210101/" class="">Batch.V1alpha1api20210101</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/cache.v1alpha1api20201201/" class="">Cache.V1alpha1api20201201</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/cache.v1alpha1api20210301/" class="">Cache.V1alpha1api20210301</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/compute.v1alpha1api20200930/" class="">Compute.V1alpha1api20200930</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/compute.v1alpha1api20201201/" class="">Compute.V1alpha1api20201201</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/compute.v1alpha1api20210701/" class="">Compute.V1alpha1api20210701</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/containerregistry.v1alpha1api20210901/" class="">Containerregistry.V1alpha1api20210901</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/containerservice.v1alpha1api20210501/" class="">Containerservice.V1alpha1api20210501</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/dbformysql.v1alpha1api20210501/" class="">Dbformysql.V1alpha1api20210501</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/dbforpostgresql.v1alpha1api20210601/" class="">Dbforpostgresql.V1alpha1api20210601</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/documentdb.v1alpha1api20210515/" class="">Documentdb.V1alpha1api20210515</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/eventgrid.v1alpha1api20200601/" class="">Eventgrid.V1alpha1api20200601</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/eventhub.v1alpha1api20211101/" class="">Eventhub.V1alpha1api20211101</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/insights.v1alpha1api20180501preview/" class="">Insights.V1alpha1api20180501preview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/insights.v1alpha1api20200202/" class="">Insights.V1alpha1api20200202</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/managedidentity.v1alpha1api20181130/" class="">Managedidentity.V1alpha1api20181130</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/network.v1alpha1api20201101/" class="">Network.V1alpha1api20201101</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/operationalinsights.v1alpha1api20210601/" class="">Operationalinsights.V1alpha1api20210601</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/resources.v1alpha1api20200601/" class="">Resources.V1alpha1api20200601</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/servicebus.v1alpha1api20210101preview/" class="">Servicebus.V1alpha1api20210101preview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/signalrservice.v1alpha1api20211001/" class="">Signalrservice.V1alpha1api20211001</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://azure.github.io/azure-service-operator/reference/storage.v1alpha1api20210401/" class="">Storage.V1alpha1api20210401</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/azure-service-operator/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Add a New Code Generated Resource</strong>

  <label for="toc-control">
    
    <img src="/azure-service-operator/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#what-resources-can-be-code-generated">What resources can be code generated?</a></li>
    <li><a href="#determine-a-resource-to-add">Determine a resource to add</a></li>
    <li><a href="#adding-the-resource-to-the-code-generation-configuration-file">Adding the resource to the code generation configuration file</a></li>
    <li><a href="#run-the-code-generator">Run the code generator</a></li>
    <li><a href="#fix-any-errors-raised-by-the-code-generator">Fix any errors raised by the code generator</a>
      <ul>
        <li><a href="#resource-looks-like-a-resource-reference-but-was-not-labelled-as-one">&lt;Resource&gt; looks like a resource reference but was not labelled as one</a></li>
      </ul>
    </li>
    <li><a href="#examine-the-generated-resource">Examine the generated resource</a>
      <ul>
        <li><a href="#common-issues">Common issues</a></li>
      </ul>
    </li>
    <li><a href="#determine-if-the-resource-has-secrets-generated-by-azure">Determine if the resource has secrets generated by Azure</a></li>
    <li><a href="#write-a-crud-test-for-the-resource">Write a CRUD test for the resource</a></li>
    <li><a href="#run-the-crud-test-for-the-resource-and-commit-the-recording">Run the CRUD test for the resource and commit the recording</a></li>
    <li><a href="#add-a-new-sample">Add a new sample</a></li>
    <li><a href="#send-a-pr">Send a PR</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="adding-a-new-code-generated-resource-to-aso-v2">
  Adding a new code generated resource to ASO v2
  <a class="anchor" href="#adding-a-new-code-generated-resource-to-aso-v2">#</a>
</h1>
<p>This document discusses how to add a new resource to the ASO v2 code generation configuration. Check out <a href="https://github.com/Azure/azure-service-operator/pull/1568">this PR</a> if you&rsquo;d like to see what the end product looks like.</p>
<h2 id="what-resources-can-be-code-generated">
  What resources can be code generated?
  <a class="anchor" href="#what-resources-can-be-code-generated">#</a>
</h2>
<p>Any ARM resource can be generated. There are a few ways to determine if a resource is an ARM resource:</p>
<ol>
<li>If the resource is defined in the <a href="https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json">ARM template JSON schema</a>, or the <a href="https://schema.management.azure.com/schemas/common/autogeneratedResources.json">auto-generated ARM template JSON schema</a> it is an ARM resource.</li>
<li>If the resource is defined in a <code>resource-manager</code> folder in the <a href="https://github.com/Azure/azure-rest-api-specs/tree/main/specification">Azure REST API specs</a> repo, it is an ARM resource.</li>
</ol>
<p>If the resource is not in either of the above places and cannot be deployed via an ARM template, then it&rsquo;s not an ARM resource and currently cannot be code generated.</p>
<h2 id="determine-a-resource-to-add">
  Determine a resource to add
  <a class="anchor" href="#determine-a-resource-to-add">#</a>
</h2>
<p>There are three key pieces of information required before adding a resource to the code generation configuration file, and each of them can be found in the
<a href="https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json">ARM template JSON schema</a> or the <a href="https://schema.management.azure.com/schemas/common/autogeneratedResources.json">auto-generated ARM template JSON schema</a>. To get started, find the entry for the resource in one of the two templates mentioned. For example, the entry for Azure Network Security Groups looks like this:
<code>{ &quot;$ref&quot;: &quot;https://schema.management.azure.com/schemas/2020-11-01/Microsoft.Network.json#/resourceDefinitions/networkSecurityGroups&quot; },</code></p>
<p><strong>Note</strong>: In many cases there will be multiple entries for the same resource, each with a different <code>api-version</code>. It is <em>strongly</em> recommended that you use the latest available non-preview <code>api-version</code>.</p>
<ol>
<li>
<p>The <code>name</code> of the resource.</p>
<p>You usually know this going in. In our example above, the name of the resource is <code>networkSecurityGroups</code>.</p>
</li>
<li>
<p>The <code>group</code> the resource is in.</p>
<p>This is usually named after the Azure service, for example <code>resources</code> or <code>documentdb</code>. In our example entry from above, this is <code>network</code>.</p>
</li>
<li>
<p>The <code>api-version</code> of the resource.</p>
<p>This is usually a date, sometimes with a <code>-preview</code> suffix. In our example entry from above, this is <code>2020-11-01</code>.</p>
</li>
</ol>
<h2 id="adding-the-resource-to-the-code-generation-configuration-file">
  Adding the resource to the code generation configuration file
  <a class="anchor" href="#adding-the-resource-to-the-code-generation-configuration-file">#</a>
</h2>
<p>The code generation configuration file is located <a href="https://github.com/Azure/azure-service-operator/blob/main/v2/azure-arm.yaml">here</a>. To add a new resource to this file, find the <code>objectModelConfiguration</code> section of the file.</p>
<p>Find the configuration for the <code>group</code> you want; if it&rsquo;s not there, create a new one, inserting it into the existing list in alphabetical order. Within the group, find the <code>version</code> you want; again, create a new one if it&rsquo;s not already there.</p>
<p>Add your new resource to the list for that version, including the directive <code>$export: true</code> nested beneath. The final result should look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">&lt;group&gt;</span>:
  <span style="color:#f92672">&lt;version&gt;</span>:
    <span style="color:#f92672">&lt;resource name&gt;</span>: <span style="color:#75715e"># singular, typically just remove the trailing &#34;s&#34;</span>
      <span style="color:#f92672">$export</span>: <span style="color:#66d9ef">true</span>
</code></pre></div><p>For example, taking the <em>Azure Network Security Groups</em> sample from above:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">network</span>:
  <span style="color:#f92672">2020-11-01</span>:
    <span style="color:#f92672">NetworkSecurityGroup</span>:
      <span style="color:#f92672">$export</span>: <span style="color:#66d9ef">true</span>
</code></pre></div><p>If ASO was already configured to generate resources from this group (or version), you will need to add your new configuration around the existing values.</p>
<h2 id="run-the-code-generator">
  Run the code generator
  <a class="anchor" href="#run-the-code-generator">#</a>
</h2>
<p>Follow the steps in the <a href="../contributing/">contributing guide</a> to set up your development environment.
Once you have a working development environment, run the <code>task</code> command to run the code generator.</p>
<h2 id="fix-any-errors-raised-by-the-code-generator">
  Fix any errors raised by the code generator
  <a class="anchor" href="#fix-any-errors-raised-by-the-code-generator">#</a>
</h2>
<h3 id="resource-looks-like-a-resource-reference-but-was-not-labelled-as-one">
  &lt;Resource&gt; looks like a resource reference but was not labelled as one
  <a class="anchor" href="#resource-looks-like-a-resource-reference-but-was-not-labelled-as-one">#</a>
</h3>
<p>Example:</p>
<blockquote>
<p>Replace cross-resource references with genruntime.ResourceReference:
[&ldquo;github.com/Azure/azure-service-operator/hack/generated/_apis/containerservice/v1alpha1api20210501/PrivateLinkResource.Id&rdquo; looks like a resource reference but was not labelled as one.</p>
</blockquote>
<p>To fix this error, determine whether the property in question is an ARM ID or not, and then update the <code>objectModelConfiguration</code> section in the configuration file.</p>
<p>Find the section you added earlier, adding your property with an <code>$armReference:</code> declaration nested below.</p>
<p>If the property is an ARM ID, use <code>$armReference: true</code> to flag that property as a reference:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">network</span>:
  <span style="color:#f92672">2020-11-01</span>:
    <span style="color:#f92672">NetworkSecurityGroup</span>:
      <span style="color:#f92672">$export</span>: <span style="color:#66d9ef">true</span>
      <span style="color:#f92672">PrivateLinkResource</span>: 
        <span style="color:#f92672">$armReference</span>: <span style="color:#66d9ef">true</span> <span style="color:#75715e"># the property IS an ARM reference</span>
</code></pre></div><p>If the property is <em><strong>not</strong></em> an ARM ID, use <code>$armReference: false</code> instead:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">network</span>:
  <span style="color:#f92672">2020-11-01</span>:
    <span style="color:#f92672">NetworkSecurityGroup</span>:
      <span style="color:#f92672">$export</span>: <span style="color:#66d9ef">true</span>
      <span style="color:#f92672">PrivateLinkResource</span>: 
        <span style="color:#f92672">$armReference</span>: <span style="color:#66d9ef">false</span> <span style="color:#75715e"># the property IS NOT an ARM reference</span>
</code></pre></div><p>TODO: expand on other common errors</p>
<h2 id="examine-the-generated-resource">
  Examine the generated resource
  <a class="anchor" href="#examine-the-generated-resource">#</a>
</h2>
<p>After running the generator, the new resource you added should be in the <a href="https://github.com/Azure/azure-service-operator/blob/main/v2/api/">apis</a> directory.</p>
<p>Have a look through the files in the directory named after the <code>group</code> and <code>version</code> of the resource that was added.
In our <code>NetworkSecurityGroups</code> example, the best place to start is <code>/v2/api/network/v1alpha1api20201101/network_security_group_types_gen.go</code>
There may be other resources that already exist in that same directory - that&rsquo;s expected if ASO already supported some resources from that provider and API version.</p>
<p>Starting with the <code>network_security_group_types_gen.go</code> file, find the struct representing the resource you just added. It should be near the top and look something like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// +kubebuilder:object:root=true
</span><span style="color:#75715e">// +kubebuilder:subresource:status
</span><span style="color:#75715e">// +kubebuilder:storageversion
</span><span style="color:#75715e">// +kubebuilder:printcolumn:name=&#34;Ready&#34;,type=&#34;string&#34;,JSONPath=&#34;.status.conditions[?(@.type==&#39;Ready&#39;)].status&#34;
</span><span style="color:#75715e">// +kubebuilder:printcolumn:name=&#34;Reason&#34;,type=&#34;string&#34;,JSONPath=&#34;.status.conditions[?(@.type==&#39;Ready&#39;)].reason&#34;
</span><span style="color:#75715e">// +kubebuilder:printcolumn:name=&#34;Message&#34;,type=&#34;string&#34;,JSONPath=&#34;.status.conditions[?(@.type==&#39;Ready&#39;)].message&#34;
</span><span style="color:#75715e">//Generated from: https://schema.management.azure.com/schemas/2020-11-01/Microsoft.Network.json#/resourceDefinitions/networkSecurityGroups
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">NetworkSecurityGroup</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">metav1</span>.<span style="color:#a6e22e">TypeMeta</span>   <span style="color:#e6db74">`json:&#34;,inline&#34;`</span>
	<span style="color:#a6e22e">metav1</span>.<span style="color:#a6e22e">ObjectMeta</span> <span style="color:#e6db74">`json:&#34;metadata,omitempty&#34;`</span>
	<span style="color:#a6e22e">Spec</span>              <span style="color:#a6e22e">NetworkSecurityGroups_Spec</span>                                           <span style="color:#e6db74">`json:&#34;spec,omitempty&#34;`</span>
	<span style="color:#a6e22e">Status</span>            <span style="color:#a6e22e">NetworkSecurityGroup_Status_NetworkSecurityGroup_SubResourceEmbedded</span> <span style="color:#e6db74">`json:&#34;status,omitempty&#34;`</span>
}
</code></pre></div><p>Look over the <code>Spec</code> and <code>Status</code> types and their properties (and the properties of their properties and so-on).
The Azure REST API specs and ARM template JSON schemas which these types were derived from are not perfect. Sometimes they mark a <code>readonly</code> property as mutable or have another error or mistake.</p>
<h3 id="common-issues">
  Common issues
  <a class="anchor" href="#common-issues">#</a>
</h3>
<p>This is a non-exhaustive list of common issues which may need to be fixed in our configuration file.</p>
<h4 id="properties-that-should-have-been-marked-read-only-but-werent">
  Properties that should have been marked read-only but weren&rsquo;t
  <a class="anchor" href="#properties-that-should-have-been-marked-read-only-but-werent">#</a>
</h4>
<p>There is a section in the config detailing a number of these errors which have been fixed. Look for &ldquo;Deal with properties that should have been marked readOnly but weren&rsquo;t&rdquo;.</p>
<p>Here&rsquo;s an example, where DocumentDB missed setting the <code>provisioningState</code> property to read-only. We override it in the config:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">  - <span style="color:#f92672">group</span>: <span style="color:#ae81ff">documentdb</span>
    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Location </span> <span style="color:#75715e"># This type is subsequently flattened into NamespacesTopics_Spec</span>
    <span style="color:#f92672">property</span>: <span style="color:#ae81ff">ProvisioningState</span>
    <span style="color:#f92672">remove</span>: <span style="color:#66d9ef">true</span>
    <span style="color:#f92672">because</span>: <span style="color:#ae81ff">This property should have been marked readonly but wasn&#39;t.</span>
</code></pre></div><h2 id="determine-if-the-resource-has-secrets-generated-by-azure">
  Determine if the resource has secrets generated by Azure
  <a class="anchor" href="#determine-if-the-resource-has-secrets-generated-by-azure">#</a>
</h2>
<p>Some resources, such as <code>microsoft.storage/accounts</code> and <code>microsoft.documentdb/databaseAccounts</code>, have keys and endpoints generated by
Azure. Unfortunately, there is no good way to automatically detect these in the specs which the code generator runs on.</p>
<p><strong>You must manually identify if the resource you are adding has keys (or endpoints) which users will want exported to a secret store</strong>.
If the resource in question <em>does</em> have Azure generated secrets or endpoints, identify those endpoints in the configuration file
by specifying <code>$azureGeneratedSecrets</code>.</p>
<p>Our example resource above does not have any Azure generated secrets. As mentioned above, <code>microsoft.documentdb/databaseAccounts</code> has
Azure generated secrets. Here is the snippet from the configuration file showing how they were configured.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">  <span style="color:#f92672">documentdb</span>:
    <span style="color:#f92672">2021-05-15</span>:
      <span style="color:#f92672">DatabaseAccount</span>:
        <span style="color:#f92672">$export</span>: <span style="color:#66d9ef">true</span>
        <span style="color:#f92672">$azureGeneratedSecrets</span>:
          - <span style="color:#ae81ff">PrimaryMasterKey</span>
          - <span style="color:#ae81ff">SecondaryMasterKey</span>
          - <span style="color:#ae81ff">PrimaryReadonlyMasterKey</span>
          - <span style="color:#ae81ff">SecondaryReadonlyMasterKey</span>
          - <span style="color:#ae81ff">DocumentEndpoint</span>
</code></pre></div><p>Since these properties are manually configured, they must also be retrieved from Azure manually. This can be done using
the extension framework supported by the operator. Use the <a href="https://github.com/Azure/azure-service-operator/blob/main/v2/api/documentdb/customizations/database_account_extensions.go">documentdb secrets extension</a>
as a template for authoring an extension for your resource.</p>
<!-- TODO: Do we have a link to give more details about extensions and how they work? -->
<h2 id="write-a-crud-test-for-the-resource">
  Write a CRUD test for the resource
  <a class="anchor" href="#write-a-crud-test-for-the-resource">#</a>
</h2>
<p>The best way to do this is to start from an <a href="https://github.com/Azure/azure-service-operator/blob/main/v2/internal/controllers/crd_cosmosdb_mongodb_test.go">existing test</a> and modify it to work for your resource. It can also be helpful to refer to examples in the <a href="https://github.com/Azure/azure-quickstart-templates">ARM templates GitHub repo</a>.</p>
<h2 id="run-the-crud-test-for-the-resource-and-commit-the-recording">
  Run the CRUD test for the resource and commit the recording
  <a class="anchor" href="#run-the-crud-test-for-the-resource-and-commit-the-recording">#</a>
</h2>
<p>See <a href="../contributing/#running-integration-tests">the code generator README</a> for how to run recording tests.</p>
<h2 id="add-a-new-sample">
  Add a new sample
  <a class="anchor" href="#add-a-new-sample">#</a>
</h2>
<p>The samples are located in the <a href="https://github.com/Azure/azure-service-operator/blob/main/v2/config/samples">samples directory</a>. There should be at least one sample for each kind of supported resource. These currently need to be added manually. It&rsquo;s possible in the future we will automatically generate samples similar to how we automatically generate CRDs and types, but that doesn&rsquo;t happen today.</p>
<h2 id="send-a-pr">
  Send a PR
  <a class="anchor" href="#send-a-pr">#</a>
</h2>
<p>You&rsquo;re all done!</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#what-resources-can-be-code-generated">What resources can be code generated?</a></li>
    <li><a href="#determine-a-resource-to-add">Determine a resource to add</a></li>
    <li><a href="#adding-the-resource-to-the-code-generation-configuration-file">Adding the resource to the code generation configuration file</a></li>
    <li><a href="#run-the-code-generator">Run the code generator</a></li>
    <li><a href="#fix-any-errors-raised-by-the-code-generator">Fix any errors raised by the code generator</a>
      <ul>
        <li><a href="#resource-looks-like-a-resource-reference-but-was-not-labelled-as-one">&lt;Resource&gt; looks like a resource reference but was not labelled as one</a></li>
      </ul>
    </li>
    <li><a href="#examine-the-generated-resource">Examine the generated resource</a>
      <ul>
        <li><a href="#common-issues">Common issues</a></li>
      </ul>
    </li>
    <li><a href="#determine-if-the-resource-has-secrets-generated-by-azure">Determine if the resource has secrets generated by Azure</a></li>
    <li><a href="#write-a-crud-test-for-the-resource">Write a CRUD test for the resource</a></li>
    <li><a href="#run-the-crud-test-for-the-resource-and-commit-the-recording">Run the CRUD test for the resource and commit the recording</a></li>
    <li><a href="#add-a-new-sample">Add a new sample</a></li>
    <li><a href="#send-a-pr">Send a PR</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












