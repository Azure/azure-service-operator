# Creating a new release of ASO v2

1. Go to the [releases](https://github.com/Azure/azure-service-operator/releases) page and draft a new release.
2. In the tag dropdown, type the name of the new tag you'd like to create (it should match the pattern of previous releases tags, for example: `v2.0.0-alpha.1`). The release target should be `main` (the default).
3. If publishing an alpha/beta, be sure to mark the release as a pre-release.
4. Write a "Release Notes" section. This can be generated by looking through the commits between the last release and now: `git log v2.0.0-alpha.0..main`. In the future it would be nice to automatically generate this.
5. Publish the release. This will automatically trigger a GitHub action to build and publish an updated Docker image with the latest manager changes.
6. Ensure that the action associated with your release finishes successfully.

# Testing the new release
1. Download the yaml file from the release page
2. Create a kind cluster: `task controller:kind-create`
3. Install cert-manager: `task controller:install-cert-manager`
4. Create the namespace for the operator: `k create namespace azureserviceoperator-system`
5. Source the SP credentials to use for the secret and then run `./scripts/deploy_testing_secret.sh sp`
6. Deploy the operator from MCR: `k apply --server-side=true -f <path-to-downloaded-yaml>` (We need to use [server-side apply](https://kubernetes.io/docs/reference/using-api/server-side-apply/) because the CRD for VirtualMachines is large enough that it can't fit in the `last-applied-configuration` annotation client-side `kubectl apply` uses.)
7. Wait for it to start: `k get all -n azureserviceoperator-system`
8. Create a resource group: `k apply -f v2/config/samples/microsoft.resources/v1alpha1api20200601_resourcegroup.yaml`
9. Make sure it deploys successfully, and check in the portal.

# Fixing an incorrect release
If there was an issue publishing a new release, we may want to delete the existing release and try again. 
Only do this if you've just published the release and there is something wrong with it. We shouldn't be deleting releases people are actually using. 

1. Delete the release in the [releases](https://github.com/Azure/azure-service-operator/releases) page.
2. Delete the tag: `git push <origin> --delete <tag>`, for example `git push origin --delete v2.0.0-alpha.1`.

At this point, you can safely publish a "new" release with the same name.
