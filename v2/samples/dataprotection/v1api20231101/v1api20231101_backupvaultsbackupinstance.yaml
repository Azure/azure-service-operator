# create 4 role assingments and trusted access to make it protection configured.
# Extension identity on SA
# Vault identity on cluster
# Vault identity on RG
# Cluster identity on RG
apiVersion: dataprotection.azure.com/v1api20231101
kind: BackupVaultsBackupInstance
metadata:
  name: aso-sample-backupinstance
  namespace: default
spec:
  owner:
    name: aso-sample-backupvault 
  properties:
    objectType: BackupInstance
    friendlyName: aso-sample-backupinstance
    dataSourceInfo:
      objectType: Datasource
      datasourceType: Microsoft.ContainerService/managedClusters
      resourceName: aso-sample-aks
      resourceLocation: westus2
      resourceType: Microsoft.ContainerService/managedClusters
      resourceUriReference:
        name: aso-sample-aks
        group: containerservice.azure.com
        kind: ManagedCluster
      resourceReference:
        name: aso-sample-aks
        group: containerservice.azure.com
        kind: ManagedCluster
    dataSourceSetInfo:
      objectType: DatasourceSet
      datasourceType: Microsoft.ContainerService/managedClusters
      resourceName: aso-sample-aks
      resourceLocation: westus2
      resourceType: Microsoft.ContainerService/managedClusters
      resourceUriReference:
        name: aso-sample-aks
        group: containerservice.azure.com
        kind: ManagedCluster
      resourceReference:
        name: aso-sample-aks
        group: containerservice.azure.com
        kind: ManagedCluster
    policyInfo:
      policyReference:
        group: dataprotection.azure.com
        kind: BackupVaultsBackupPolicy
        name: aso-sample-backuppolicy
      policyParameters:
        dataStoreParametersList:
          - azureOperationalStoreParameters:
              objectType: AzureOperationalStoreParameters
              resourceGroupReference:
                name: aso-sample-rg
                group: resources.azure.com
                kind: ResourceGroup
              dataStoreType: OperationalStore
        backupDatasourceParametersList:
          - kubernetesClusterBackupDatasourceParameters:
              includeClusterScopeResources: true
              snapshotVolumes: true
              objectType: KubernetesClusterBackupDatasourceParameters
