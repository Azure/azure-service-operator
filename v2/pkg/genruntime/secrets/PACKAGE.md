# Secrets Package

## Overview

The secrets package provides utilities for handling Azure resource secrets in the Azure Service Operator (ASO). It supports collecting, validating, and exporting secret values that are generated by Azure resources and need to be stored in Kubernetes secrets.

**Secret Collection and Management**: The package provides a `Collector` that gathers secret values and their associated destinations, then produces Kubernetes Secret objects that can be written to the cluster. This allows for efficient collection and organization of multiple secrets that may be written to the same Kubernetes Secret object.

**Secret Validation**: The package includes validation utilities to ensure that secret destinations don't conflict with each other, preventing accidental overwrites of secret values. This includes validation for both static destinations and those derived from CEL expressions.

**Secret Export Interface**: The package defines an interface for components that can export secrets based on CEL (Common Expression Language) expressions, allowing for dynamic determination of secret destinations at runtime.

## Testing

The package uses the Gomega assertion library for testing. The tests are primarily unit tests that verify the behavior of the various functions in the package.

To run the tests for this package, use:

```bash
go test -v github.com/Azure/azure-service-operator/v2/pkg/genruntime/secrets
```

The tests include:
- Validation tests for secret destinations
- Tests for the collector functionality
- Tests for secret selection and conversion utilities

## Related packages

- **`v2/pkg/genruntime`**: Contains the core types used by this package, including `SecretReference`, `SecretDestination`, and related types that represent references to secrets.

- **`v2/pkg/genruntime/core`**: Provides core definitions used across the generic reconciler and generated code, including error types and interfaces used by the secrets package.

- **`v2/pkg/genruntime/configmaps`**: A similar package for handling ConfigMaps that shares design patterns with the secrets package.

- **`v2/internal/genericarmclient`**: Used in conjunction with the secrets package to interact with Azure Resource Manager APIs for retrieving secrets.

- **`v2/internal/set`**: Provides set implementation used by the secrets package for tracking and managing unique key pairs.

- **`v2/internal/util/cel`**: Contains the CEL evaluator used for evaluating expressions in secret destinations.
